<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />

    <script type="text/javascript" src="roslib.min.js"></script>
    <script type="text/javascript" src="js-yaml.min.js"></script>
    <script type="text/javascript" src="FileSaver.js"></script>
    <link rel="stylesheet" type="text/css" href="./index.css" />

    <script type="text/javascript" type="text/javascript" defer>
      var ros = new ROSLIB.Ros({
        url: "ws://localhost:9090",
      });

      var active_chair_nums = new ROSLIB.Param({
        ros: ros,
        name: "active_chair_nums",
      });

      var chairs = [];
      var live_status = new Map();

      active_chair_nums.get(function (value) {
        chairs = value.map((v) => String(v));
        chairs.map((chair) => live_status.set(chair, null));

        document.getElementById("num_chairs") = String(chairs.length);
        document.getElementById("active_chair_list") = chairs.toString();
      });
      // var chairs = ["1", "2", "3", "4"];
      console.log(live_status);

      var test_choreo = [
        "00Bf2.0f2.0t5",
        "00BAp",
        "00Bf0.0f0.0t5",
        "00Bf0.0f0.0t5",
        "00BAk",
        "00Br2.0r2.0t5",
        "00Br2.0r2.0t5",
        "00BAt",
        "00Bf0.0f0.0t5",
        "00Bf0.0f0.0t5",
        "00Bend",
      ];

      ros.on("connection", function () {
        document.getElementById("status").innerHTML = "Connected";
      });

      ros.on("error", function (error) {
        document.getElementById("status").innerHTML = "Error";
      });

      ros.on("close", function () {
        document.getElementById("status").innerHTML = "Closed";
      });

      var txt_listener = new ROSLIB.Topic({
        ros: ros,
        name: "/from_hub_receiver",
        messageType: "std_msgs/String",
      });

      var to_hub_manager_pub = new ROSLIB.Topic({
        ros: ros,
        name: "/to_hub_manager",
        messageType: "std_msgs/String",
      });

      getTextForStatus = function (status) {
        if (status == "r") {
          return "READY";
        } else if (status == "e") {
          return "EXCLUDE";
        } else if (status == "s") {
          return "SUCCESS";
        } else if (status == "f") {
          return "FAILURE";
        } else if (status == "o" || status == null) {
          return "OFFLINE";
        } else {
          return "ERROR: " + status;
        }
      };

      function updateChairStatus(key, status) {
        let element = document.getElementById(key + "status");
        if (element) {
          element.innerHTML = getTextForStatus(status);
          element.classList.remove(...element.classList);
          element.classList.add("status", status);
        }
      }

      txt_listener.subscribe(function (m) {
        // console.log(m, m.length, chairs.includes(m.data[0]));
        if (m.data.length == 2 && chairs.includes(m.data[0])) {
          live_status.set(m.data[0], m.data[1]);
          document.getElementById("msg").innerHTML = m.data;
          updateChairStatus(m.data[0], m.data[1]);
        }
        // image
        if (m.data[1] == "i") {
          console.log(m.data);
        }
      });

      function checkStatus() {
        for (let [key, value] of live_status) {
          if (value == null) {
            updateChairStatus(key, "o");
          }
          live_status.set(key, null);
        }
        setTimeout(checkStatus, 5000);
      }

      checkStatus();

      hub_dir_listener = new ROSLIB.Topic({
        ros: ros,
        name: "/from_hub",
        messageType: "std_msgs/String",
      });

      submitForm = function (e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const formProps = Object.fromEntries(formData);

        const cmd = formProps.custom_handwritten;

        if (
          cmd.length == 8 &&
          (cmd[0] == "f" || cmd[0] == "r") &&
          cmd[1] >= "0" &&
          cmd[1] <= "9" &&
          cmd[2] == "." &&
          cmd[3] >= "0" &&
          cmd[3] <= "9" &&
          (cmd[4] == "f" || cmd[4] == "r") &&
          cmd[5] >= "0" &&
          cmd[5] <= "9" &&
          (cmd[6] = ".") &&
          cmd[7] >= "0" &&
          cmd[7] <= "9"
        ) {
          hub_dir_listener.publish(
            formatMsg(e.target.id[0], "hand " + formProps.custom_handwritten)
          );
          document.getElementById(e.target.id).reset();
        } else {
          alert(
            "Custom commands must be 8 characters: [f/r][#.#][f/r][#.#]\nExample: f1.0f1.0"
          );
        }
      };

      move = function () {
        var dir = new ROSLIB.Message({
          data: "hello",
        });
        hub_dir_listener.publish(dir);
      };

      formatMsg = function (id, msg) {
        return new ROSLIB.Message({
          data: id + msg,
        });
      };

      toggle = function (id) {
        hub_dir_listener.publish(formatMsg(id, "toggle"));
      };
      stop = function (id) {
        hub_dir_listener.publish(formatMsg(id, "stop"));
      };
      start = function (id) {
        hub_dir_listener.publish(formatMsg(id, "start"));
      };
      fwd = function (id) {
        hub_dir_listener.publish(formatMsg(id, "fwd"));
      };
      ffwd = function (id) {
        hub_dir_listener.publish(formatMsg(id, "ffwd"));
      };
      bwd = function (id) {
        hub_dir_listener.publish(formatMsg(id, "bwd"));
      };
      fbwd = function (id) {
        hub_dir_listener.publish(formatMsg(id, "fbwd"));
      };
      fwdl = function (id) {
        hub_dir_listener.publish(formatMsg(id, "fwdl"));
      };
      fwdr = function (id) {
        hub_dir_listener.publish(formatMsg(id, "fwdr"));
      };
      bwdl = function (id) {
        hub_dir_listener.publish(formatMsg(id, "bwdl"));
      };
      bwdr = function (id) {
        hub_dir_listener.publish(formatMsg(id, "bwdr"));
      };
      pivotl = function (id) {
        hub_dir_listener.publish(formatMsg(id, "pivotl"));
      };
      pivotr = function (id) {
        hub_dir_listener.publish(formatMsg(id, "pivotr"));
      };

      send_test_choreo = function () {
        console.log("SENDING TEST CHOREO");
        test_choreo.forEach((msg) => {
          var dir = new ROSLIB.Message({
            data: msg,
          });
          to_hub_manager_pub.publish(dir);
        });
      };

      function switchscreen(newScreenId) {
        var liveScreen = document.getElementById("live");
        var configScreen = document.getElementById("config");
        if (newScreenId == "live") {
          configScreen.style.display = "none";
          liveScreen.style.display = "block";
        } else {
          liveScreen.style.display = "none";
          configScreen.style.display = "block";
        }
      }

      function renderJSON(obj) {
        "use strict";
        var keys = [],
          retValue = "";
        for (var key in obj) {
          if (typeof obj[key] === "object") {
            retValue += "<div class='tree'>" + key;
            retValue += renderJSON(obj[key]);
            retValue += "</div>";
          } else {
            retValue +=
              "<div class='tree'>" + key + " = " + obj[key] + "</div>";
          }

          keys.push(key);
        }
        console.log(retValue);
        return retValue;
      }

      openYaml = function (e) {
        console.log("OPENING YAML");
        e.preventDefault();
        console.log(e.target);
        const formData = new FormData(e.target);
        const formProps = Object.fromEntries(formData);

        const file = formProps.configFile;
        let ymlcontents = null;

        const reader = new FileReader();
        reader.addEventListener("load", (event) => {
          // event.target.result;
          ymlcontents = event.target.result.replace(/\r/g, "\n");
          // alert(ymlcontents);
          console.log(ymlcontents);

          document.getElementById("ymlTextArea").innerHTML = ymlcontents;

          const doc = jsyaml.load(ymlcontents);
          console.log(doc);

          // document.getElementById('ymlContainer').insertAdjacentHTML('beforeend', renderJSON(doc));
        });
        reader.readAsText(file);
      };

      saveYaml = function (e) {
        console.log("SAVING YAML");
        e.preventDefault();

        const textToSave = document.getElementById("ymlTextArea").innerHTML;
        const filename = document
          .getElementById("configFile")
          .files.item(0).name;

        var blob = new Blob([textToSave], { type: "text/plain;charset=utf-8" });
        saveAs(blob, filename);
      };

      sendYaml = function () {
        const filename = document
          .getElementById("configFile")
          .files.item(0).name;
        const textToSend =
          "config " +
          filename +
          " " +
          document.getElementById("ymlTextArea").innerHTML;
        hub_dir_listener.publish(formatMsg("0", textToSend));
      };

      sendCameraConfig = function (e) {
        e.preventDefault();

        const config = {
          camera: {
            topBandWidth: topWidth,
            sideBandWidth: sideWidth,
            imageWidth: imageWidth,
            imageHeight: imageHeight,
            brightnessThreshold: brightnessThreshold,
            sidePercentThreshold: sidePercent,
            topPercentThreshold: topPercent,
            numMiddlePixels:
              imageWidth * imageHeight -
              topWidth * imageWidth -
              2 * sideWidth * imageHeight +
              2 * topWidth * sideWidth,
          },
        };
        const textToSend = "config camera.yaml " + JSON.stringify(config);
        console.log(textToSend);
        hub_dir_listener.publish(formatMsg("0", textToSend));
      };

      const getColorIndicesForCoord = (x, y, width) => {
        const red = y * (width * 4) + x * 4;
        return [red, red + 1, red + 2, red + 3];
      };

      function setPixel(imageData, x, y, r, g, b, a) {
        index = (x + y * imageData.width) * 4;
        imageData.data[index + 0] = r;
        imageData.data[index + 1] = g;
        imageData.data[index + 2] = b;
        imageData.data[index + 3] = a;
      }

      var brightnessThreshold = 0;
      var sideWidth = 0;
      var topWidth = 0;
      var sidePercent = 0;
      var topPercent = 0;
      const imageWidth = 640;
      const imageHeight = 480;

      function setBrightnessThreshold(newValue) {
        brightnessLabel.value = newValue;
        brightnessThreshold = newValue;
        drawImageBrightness();
      }

      function setSideWidth(newValue) {
        sideWidthLabel.value = newValue;
        sideWidth = newValue;
        drawImageBrightness();
      }

      function setTopWidth(newValue) {
        topWidthLabel.value = newValue;
        topWidth = newValue;
        drawImageBrightness();
      }

      function setSidePercent(newValue) {
        sidePercentLabel.value = newValue;
        sidePercent = newValue;
        drawImageBrightness();
      }

      function setTopPercent(newValue) {
        topPercentLabel.value = newValue;
        topPercent = newValue;
        drawImageBrightness();
      }

      function drawImageScaled(img, ctx, brightnessThreshold) {
        var canvas = ctx.canvas;
        var hRatio = canvas.width / img.width;
        var vRatio = canvas.height / img.height;
        var ratio = Math.min(hRatio, vRatio);
        var centerShift_x = (canvas.width - img.width * ratio) / 2;
        var centerShift_y = (canvas.height - img.height * ratio) / 2;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          img,
          0,
          0,
          img.width,
          img.height,
          centerShift_x,
          centerShift_y,
          img.width * ratio,
          img.height * ratio
        );
      }

      function inTop(counter) {
        return counter < imageWidth * topWidth;
      }

      function inLeft(counter) {
        return counter % imageWidth < sideWidth;
      }

      function inRight(counter) {
        return counter % imageWidth > imageWidth - sideWidth;
      }

      function inMiddle(counter) {
        return !(
          inTop(counter, imageWidth, topWidth) ||
          inLeft(counter, imageWidth, sideWidth) ||
          inRight(counter, imageWidth, sideWidth)
        );
      }

      function drawImageBrightness() {
        var topCount = 0;
        var leftCount = 0;
        var rightCount = 0;
        var middleCount = 0;

        console.log(sidePercent, topPercent);

        const ctx = document.getElementById("canvas").getContext("2d");
        const imgctx = document.getElementById("bottomCanvas").getContext("2d");

        var camImage = imgctx.getImageData(0, 0, canvas.width, canvas.height);
        var data = camImage.data;
        newImage = ctx.createImageData(canvas.width, canvas.height);

        for (var i = 0; i < data.length; i += 4) {
          var brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;
          const count = Math.floor(i / 4);
          if (inTop(count)) {
            topCount += brightness >= brightnessThreshold;
          }
          if (inLeft(count)) {
            leftCount += brightness >= brightnessThreshold;
          }
          if (inRight(count)) {
            rightCount += brightness >= brightnessThreshold;
          }
          if (inMiddle(count)) {
            middleCount += brightness >= brightnessThreshold;
          }
          if (brightness >= brightnessThreshold) {
            newImage.data[i] = 255;
            newImage.data[i + 1] = 0;
            newImage.data[i + 2] = 255;
            newImage.data[i + 3] = 255;
          } else {
            newImage.data[i] = data[i];
            newImage.data[i + 1] = data[i + 1];
            newImage.data[i + 2] = data[i + 2];
            newImage.data[i + 3] = 0;
          }
          if (i % 4 > 307000) {
            console.log(i);
          }
        }
        ctx.putImageData(newImage, 0, 0);

        // draw a red line
        ctx.strokeStyle = "lime";
        ctx.lineWidth = 3;

        const leftAverage = leftCount / (canvas.height * sideWidth);
        const rightAverage = rightCount / (canvas.height * sideWidth);
        const topAverage = topCount / (canvas.width * topWidth);

        console.log(leftAverage, rightAverage, topAverage);

        // left
        ctx.strokeStyle = leftAverage > sidePercent ? "red" : "lime";
        ctx.beginPath();
        ctx.moveTo(sideWidth, 0);
        ctx.lineTo(sideWidth, canvas.height);
        ctx.stroke();

        // right
        ctx.strokeStyle = rightAverage > sidePercent ? "red" : "lime";
        ctx.beginPath();
        ctx.moveTo(canvas.width - sideWidth, 0);
        ctx.lineTo(canvas.width - sideWidth, canvas.height);
        ctx.stroke();

        // top
        ctx.strokeStyle = topAverage > topPercent ? "red" : "lime";
        ctx.beginPath();
        ctx.moveTo(0, topWidth);
        ctx.lineTo(canvas.width, topWidth);
        ctx.stroke();
      }

      function toDataURL(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function () {
          var reader = new FileReader();
          reader.onloadend = function () {
            callback(reader.result);
          };
          reader.readAsDataURL(xhr.response);
        };
        xhr.open("GET", url);
        xhr.responseType = "blob";
        xhr.send();
      }

      window.onload = function () {
        switchscreen("live");

        const canvas = document.getElementById("canvas");
        canvas.width = 640;
        canvas.height = 480;

        console.log("width:", canvas.width);
        console.log("height:", canvas.height);

        const ctx = canvas.getContext("2d", { willReadFrequently: true });

        const brightnessLabel = document.getElementById("brightnessLabel");
        brightnessThreshold = parseFloat(brightnessLabel.value);
        const sideWidthLabel = document.getElementById("sideWidthLabel");
        sideWidth = parseFloat(sideWidthLabel.value);
        const topWidthLabel = document.getElementById("topWidthLabel");
        topWidth = parseFloat(topWidthLabel.value);
        const sidePercentLabel = document.getElementById("sidePercentLabel");
        sidePercent = parseFloat(sidePercentLabel.value);
        const topPercentLabel = document.getElementById("topPercentLabel");
        topPercent = parseFloat(topPercentLabel.value);
        console.log(sidePercent, topPercent);

        const bottomCanvas = document.getElementById("bottomCanvas");
        bottomCanvas.width = 640;
        bottomCanvas.height = 480;
        const imgctx = bottomCanvas.getContext("2d", {
          willReadFrequently: true,
        });

        var background = new Image();
        background.crossOrigin = "Anonymous";
        background.src = "./images/test.jpg";

        toDataURL("./images/test.jpg", function (dataUrl) {
          console.log("RESULT:", dataUrl);
        });

        background.onload = function (event) {
          drawImageScaled(background, imgctx, ctx, brightnessThreshold);
          setBrightnessThreshold(brightnessThreshold);
          setSideWidth(sideWidth);
          setTopWidth(topWidth);
        };
      };
    </script>
  </head>

  <body>
    <h1>Anonymous Autonomous</h1>
    <p>Connection status: <span id="status">NOT CONNECTED</span></p>
    <p>Last chair status received: <span id="msg"></span></p>
    <p><span id="num_chairs"></span> chairs active: <span id="active_chair_list"></span></p>
    <div class="screen" id="live" style="display: none">
      <button onclick="stop('0')" class="stop">STOP ALL</button>
      <button onclick="toggle('0')" class="auto">AUTO ALL</button>
      <button class="test_choreo" id="1" onclick="send_test_choreo()">
        TEST CHOREO
      </button>
      <div class="statuses">
        <div class="chair_monitor" id="1">
          <h2>Chair 1</h2>
          <div class="status o" id="1status">OFFLINE</div>
          <br />
          <div class="chair_control">
            <div class="directions">
              <button class="auto" id="1" onclick="toggle(this.id)">
                AUTO
              </button>
              <br />
              <button id="1" onclick="ffwd(this.id)">⤊</button>
              <div>
                <button id="1" onclick="fwdl(this.id)">⬉</button>
                <button id="1" onclick="fwd(this.id)">↑</button>
                <button id="1" onclick="fwdr(this.id)">⬈</button>
              </div>
              <div>
                <button id="1" onclick="pivotl(this.id)">⟲</button>
                <button id="1" onclick="stop(this.id)">🛑</button>
                <button id="1" onclick="pivotr(this.id)">⟳</button>
              </div>
              <div>
                <button id="1" onclick="bwdl(this.id)">⬋</button>
                <button id="1" onclick="bwd(this.id)">↓</button>
                <button id="1" onclick="bwdr(this.id)">⬊</button>
              </div>
              <button id="1" onclick="fbwd(this.id)">⤋</button>
            </div>
            <br />
            <!-- <button id="1" onclick="start(this.id)">START</button>
        <button id="1" onclick="stop(this.id)" class="stop">STOP</button> -->
            <br />
            <form
              id="1custom_handwritten"
              class="handwritten_form"
              onsubmit="return submitForm(event);"
            >
              <label for="custom_handwritten">Custom: </label>
              <input
                type="text"
                id="custom_handwritten"
                name="custom_handwritten"
                size="10"
              />
              <button type="submit" class="submit_button">Send</button>
            </form>
          </div>
        </div>
        <div class="chair_monitor" id="2">
          <h2>Chair 2</h2>
          <div class="status o" id="2status">OFFLINE</div>
          <br />
          <div class="chair_control">
            <div class="directions">
              <button class="auto" id="2" onclick="toggle(this.id)">
                AUTO
              </button>
              <br />
              <button id="2" onclick="ffwd(this.id)">⤊</button>
              <div>
                <button id="2" onclick="fwdl(this.id)">⬉</button>
                <button id="2" onclick="fwd(this.id)">↑</button>
                <button id="2" onclick="fwdr(this.id)">⬈</button>
              </div>
              <div>
                <button id="2" onclick="pivotl(this.id)">⟲</button>
                <button id="2" onclick="stop(this.id)">🛑</button>
                <button id="2" onclick="pivotr(this.id)">⟳</button>
              </div>
              <div>
                <button id="2" onclick="bwdl(this.id)">⬋</button>
                <button id="2" onclick="bwd(this.id)">↓</button>
                <button id="2" onclick="bwdr(this.id)">⬊</button>
              </div>
              <button id="2" onclick="fbwd(this.id)">⤋</button>
            </div>
            <br />
            <!-- <button id="2" onclick="start(this.id)">START</button>
        <button id="2" onclick="stop(this.id)" class="stop">STOP</button> -->
            <br />
            <form
              id="2custom_handwritten"
              class="handwritten_form"
              onsubmit="return submitForm(event);"
            >
              <label for="custom_handwritten">Custom: </label>
              <input
                type="text"
                id="custom_handwritten"
                name="custom_handwritten"
                size="10"
              />
              <button type="submit" class="submit_button">Send</button>
            </form>
          </div>
        </div>
        <div class="chair_monitor" id="3">
          <h2>Chair 3</h2>
          <div class="status o" id="3status">OFFLINE</div>
          <br />
          <div class="chair_control">
            <div class="directions">
              <button class="auto" id="3" onclick="toggle(this.id)">
                AUTO
              </button>
              <br />
              <button id="3" onclick="ffwd(this.id)">⤊</button>
              <div>
                <button id="3" onclick="fwdl(this.id)">⬉</button>
                <button id="3" onclick="fwd(this.id)">↑</button>
                <button id="3" onclick="fwdr(this.id)">⬈</button>
              </div>
              <div>
                <button id="3" onclick="pivotl(this.id)">⟲</button>
                <button id="3" onclick="stop(this.id)">🛑</button>
                <button id="3" onclick="pivotr(this.id)">⟳</button>
              </div>
              <div>
                <button id="3" onclick="bwdl(this.id)">⬋</button>
                <button id="3" onclick="bwd(this.id)">↓</button>
                <button id="3" onclick="bwdr(this.id)">⬊</button>
              </div>
              <button id="3" onclick="fbwd(this.id)">⤋</button>
            </div>
            <br />
            <!-- <button id="3" onclick="start(this.id)">START</button>
        <button id="3" onclick="stop(this.id)" class="stop">STOP</button> -->
            <br />
            <form
              id="3custom_handwritten"
              class="handwritten_form"
              onsubmit="return submitForm(event);"
            >
              <label for="custom_handwritten">Custom: </label>
              <input
                type="text"
                id="custom_handwritten"
                name="custom_handwritten"
                size="10"
              />
              <button type="submit" class="submit_button">Send</button>
            </form>
          </div>
        </div>
        <div class="chair_monitor" id="4">
          <h2>Chair 4</h2>
          <div class="status o" id="4status">OFFLINE</div>
          <br />
          <div class="chair_control">
            <div class="directions">
              <button class="auto" id="4" onclick="toggle(this.id)">
                AUTO
              </button>
              <br />
              <button id="4" onclick="ffwd(this.id)">⤊</button>
              <div>
                <button id="4" onclick="fwdl(this.id)">⬉</button>
                <button id="4" onclick="fwd(this.id)">↑</button>
                <button id="4" onclick="fwdr(this.id)">⬈</button>
              </div>
              <div>
                <button id="4" onclick="pivotl(this.id)">⟲</button>
                <button id="4" onclick="stop(this.id)">🛑</button>
                <button id="4" onclick="pivotr(this.id)">⟳</button>
              </div>
              <div>
                <button id="4" onclick="bwdl(this.id)">⬋</button>
                <button id="4" onclick="bwd(this.id)">↓</button>
                <button id="4" onclick="bwdr(this.id)">⬊</button>
              </div>
              <button id="4" onclick="fbwd(this.id)">⤋</button>
            </div>
            <br />
            <!-- <button id="4" onclick="start(this.id)">START</button>
        <button id="4" onclick="stop(this.id)" class="stop">STOP</button> -->
            <br />
            <form
              id="4custom_handwritten"
              class="handwritten_form"
              onsubmit="return submitForm(event);"
            >
              <label for="custom_handwritten">Custom: </label>
              <input
                type="text"
                id="custom_handwritten"
                name="custom_handwritten"
                size="10"
              />
              <button type="submit" class="submit_button">Send</button>
            </form>
          </div>
        </div>
        <!-- <div class="chair_monitor backup" id="backup">
      <h2>Chair 4 (backup)</h2>
      <div class="status offline">
        OFFLINE
      </div>
    </div> -->
      </div>
      <button
        onclick="switchscreen('config')"
        class="switchscreen"
        id="toConfigScreen"
      >
        switch to configuration mode
      </button>
    </div>
    <div class="screen" id="config">
      <!-- style="display:none"> -->
      <div id="cameraConfig">
        <h3>Camera</h3>
        <form id="cameraSliders">
          <div>
            <label>Brightness</label>
            <input
              type="range"
              min="0"
              max="255"
              value="125"
              class="slider"
              id="brightnessSlider"
              oninput="return setBrightnessThreshold(this.value);"
            />
            <output id="brightnessLabel">125</output>
          </div>
          <div>
            <label>Side Width</label>
            <input
              type="range"
              min="0"
              max="255"
              value="180"
              class="slider"
              id="sideWidthSlider"
              oninput="return setSideWidth(this.value);"
            />
            <output id="sideWidthLabel">180</output>
          </div>
          <div>
            <label>Top Width</label>
            <input
              type="range"
              min="0"
              max="255"
              value="120"
              class="slider"
              id="topWidthSlider"
              oninput="return setTopWidth(this.value);"
            />
            <output id="topWidthLabel">120</output>
          </div>
          <div>
            <label>Side Percentage</label>
            <input
              type="range"
              min="0"
              max="100"
              value="20"
              class="slider"
              id="sidePercentSlider"
              oninput="return setSidePercent(this.value / 100.0);"
            />
            <output id="sidePercentLabel">0.2</output>
          </div>
          <div>
            <label>Top Percentage</label>
            <input
              type="range"
              min="0"
              max="100"
              value="20"
              class="slider"
              id="topPercentSlider"
              oninput="return setTopPercent(this.value / 100.0);"
            />
            <output id="topPercentLabel">0.2</output>
          </div>
        </form>
        <button id="sendCameraConfig" onclick="return sendCameraConfig(event);">
          Send Camera Config
        </button>
        <div class="wrapper">
          <canvas id="bottomCanvas"></canvas>
          <canvas id="canvas"></canvas>
        </div>
      </div>
      <div>
        <form id="openYaml" onsubmit="return openYaml(event);">
          <label for="configFile">Select config file:</label>
          <input type="file" id="configFile" name="configFile" accept=".yaml" />
          <button type="submit">Open</button>
        </form>
      </div>
      <div id="ymlContainer"></div>
      <form id="saveYamlForm" onsubmit="return saveYaml(event);">
        <textarea id="ymlTextArea"></textarea>
        <button type="submit">Save</button>
      </form>
      <button id="sendYaml" onclick="return sendYaml();">Send</button>

      <button
        onclick="switchscreen('live')"
        class="switchscreen"
        id="toLiveScreen"
      >
        switch to live mode
      </button>
    </div>
  </body>
</html>
